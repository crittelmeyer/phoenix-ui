---
phase: 01-foundation
plan: 03
type: execute
wave: 3
depends_on: ["01-01", "01-02"]
files_modified:
  - .husky/pre-commit
  - .husky/commit-msg
  - scripts/rename-scope.mjs
  - .node-version
autonomous: true

must_haves:
  truths:
    - "Pre-commit hook runs lint-staged on staged files"
    - "Commit-msg hook enforces Conventional Commits format"
    - "pnpm lint passes across all workspace packages"
    - "pnpm typecheck passes across all workspace packages"
    - "pnpm format:check passes across all files"
    - "pnpm build completes with correct dependency ordering (tokens -> ui -> apps)"
    - "Rename script replaces @phoenix scope with custom scope"
  artifacts:
    - path: ".husky/pre-commit"
      provides: "Pre-commit hook running lint-staged"
      contains: "lint-staged"
    - path: ".husky/commit-msg"
      provides: "Commit message validation hook"
      contains: "commitlint"
    - path: "scripts/rename-scope.mjs"
      provides: "Package scope rename utility"
      contains: "@phoenix"
    - path: ".node-version"
      provides: "Node version pinning for nvm/volta"
      contains: "22"
  key_links:
    - from: ".husky/pre-commit"
      to: "package.json lint-staged config"
      via: "pnpm lint-staged command"
      pattern: "pnpm lint-staged"
    - from: ".husky/commit-msg"
      to: "commitlint.config.mjs"
      via: "commitlint --edit"
      pattern: "commitlint.*edit"
---

<objective>
Set up pre-commit hooks (Husky + lint-staged + commitlint), the scope rename script, and run full verification of the entire monorepo foundation.

Purpose: Complete the developer experience loop. After this plan, the monorepo has quality gates that prevent bad code from entering git, Conventional Commits are enforced, and a developer can clone the repo and run `pnpm install && pnpm dev` with zero configuration.

Output: Working pre-commit hooks, commit message validation, rename script, and verified end-to-end monorepo functionality.
</objective>

<execution_context>
@/Users/chris/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Husky and create git hooks</name>
  <files>
    .husky/pre-commit
    .husky/commit-msg
    .node-version
  </files>
  <action>
    Initialize Husky and create git hook files.

    Run `pnpm exec husky init` from project root to create .husky/ directory and set up the prepare script.

    **.husky/pre-commit:**
    ```
    pnpm lint-staged
    ```
    This runs lint-staged which executes eslint --fix + prettier --write on staged .js/.jsx/.ts/.tsx files, and prettier --write on staged .json/.md/.mdx/.css files (configured in root package.json lint-staged section).

    NOTE on typecheck: Per research findings, do NOT run `tsc` in lint-staged (it typechecks the entire project graph, not just staged files). The typecheck requirement for pre-commit is satisfied by running `turbo run typecheck` as a separate command. Update the pre-commit hook to also run typecheck via Turborepo:
    ```
    pnpm lint-staged
    pnpm turbo run typecheck
    ```
    This ensures all three quality gates (lint + typecheck + format:check) run before commit. lint-staged handles lint + format, and turbo handles typecheck.

    **.husky/commit-msg:**
    ```
    pnpm commitlint --edit $1
    ```
    This validates commit messages against Conventional Commits spec (feat:, fix:, chore:, docs:, etc.).

    **.node-version:**
    - Content: "22" (for nvm/volta automatic version switching)

    Make sure .husky/pre-commit and .husky/commit-msg are executable (chmod +x).
  </action>
  <verify>
    Run from project root:
    1. `ls -la .husky/pre-commit .husky/commit-msg` — both exist and are executable
    2. `cat .husky/pre-commit` contains "lint-staged" and "typecheck"
    3. `cat .husky/commit-msg` contains "commitlint"
    4. `cat .node-version` contains "22"
  </verify>
  <done>
    Husky initialized with pre-commit hook (lint-staged + typecheck) and commit-msg hook (commitlint). .node-version file pins Node 22 for version managers. Pre-commit blocks commits when lint, typecheck, or format fail.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create rename script and run full monorepo verification</name>
  <files>
    scripts/rename-scope.mjs
  </files>
  <action>
    **scripts/rename-scope.mjs:**
    Create the scope rename utility script:
    - Accepts new scope as CLI argument: `node scripts/rename-scope.mjs @yourscope`
    - Finds all files matching: **/{package.json,*.ts,*.tsx,*.js,*.jsx,*.mjs,*.md} (excluding node_modules, dist, .turbo)
    - Replaces all occurrences of "@phoenix" with the provided scope
    - Logs each modified file
    - Prints summary: "Renamed @phoenix to @yourscope"

    Use Node.js built-in fs and glob (Node 22 has glob support, or use a simple recursive readdir). Prefer using the `glob` package if available, otherwise use `fs.readdirSync` with recursive option (Node 22 supports this).

    **Full monorepo verification (run all of these):**

    1. `pnpm install` — clean install succeeds
    2. `pnpm format:check` — Prettier passes on all files. If it fails, run `pnpm format` to fix, then verify again.
    3. `pnpm lint` — ESLint passes across all packages. Fix any issues found.
    4. `pnpm typecheck` — TypeScript compiles across all packages. Fix any type errors.
    5. `pnpm build` — Turborepo builds all packages in correct order. Fix any build errors.
    6. Verify React version: `pnpm why react` should show 18.3.0
    7. Verify Turborepo pipeline: `pnpm turbo run build --dry-run` shows correct ordering

    If any verification step fails, fix the issue in the relevant files before proceeding. The goal is a green monorepo where ALL quality checks pass.

    **Important:** After fixing any formatting/linting issues, format ALL project files with `pnpm format` to ensure consistency, then re-run `pnpm format:check` to confirm.
  </action>
  <verify>
    Run ALL of these from project root (all must pass):
    1. `pnpm install` — exits 0
    2. `pnpm format:check` — exits 0
    3. `pnpm lint` — exits 0
    4. `pnpm typecheck` — exits 0
    5. `pnpm build` — exits 0
    6. `node scripts/rename-scope.mjs --help` or `node scripts/rename-scope.mjs` shows usage message
    7. `pnpm why react` shows 18.3.0
  </verify>
  <done>
    Rename script exists and works. All monorepo quality gates pass: pnpm install (zero errors), format:check (Prettier clean), lint (ESLint clean), typecheck (TypeScript strict clean), build (Turborepo correct ordering). React pinned at 18.3.0. Developer can clone repo and run `pnpm install && pnpm dev` with zero configuration.
  </done>
</task>

</tasks>

<verification>
**End-to-end Phase 1 verification (all FNDN requirements):**

FNDN-01: `pnpm install && pnpm dev` starts dev server at localhost:5173
FNDN-02: `pnpm ls -r --depth 0` shows apps/web, apps/storybook, packages/ui, packages/tokens
FNDN-03: `grep "strict" packages/typescript-config/base.json` shows strict: true; all packages extend it
FNDN-04: `pnpm --filter @phoenix/web build` succeeds; app imports @phoenix/ui
FNDN-05: `pnpm lint` passes across all packages
FNDN-06: `cat .prettierrc.json | grep tailwindcss` shows plugin present
FNDN-07: `cat packages/eslint-config/react.mjs | grep "no-arbitrary-value"` shows error rule
FNDN-08: `cat packages/eslint-config/react.mjs | grep "style"` shows forbid-dom-props/forbid-component-props
FNDN-09: `cat .husky/pre-commit` contains lint-staged + typecheck; `cat .husky/commit-msg` contains commitlint
FNDN-10: `pnpm turbo run build --dry-run` shows tokens -> ui -> web ordering
</verification>

<success_criteria>
- Pre-commit hooks block commits when lint, typecheck, or format:check fail
- Commit-msg hook enforces Conventional Commits
- Rename script replaces @phoenix with custom scope
- ALL quality gates pass: install, format:check, lint, typecheck, build
- Developer experience: clone -> pnpm install -> pnpm dev -> working app
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`
</output>
