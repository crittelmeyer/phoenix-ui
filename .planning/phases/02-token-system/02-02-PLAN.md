---
phase: 02-token-system
plan: 02
type: execute
wave: 2
depends_on: ['02-01']
files_modified:
  - apps/web/src/index.css
  - apps/web/index.html
  - apps/web/src/components/theme-toggle.tsx
  - apps/web/src/App.tsx
  - apps/web/package.json
autonomous: false

must_haves:
  truths:
    - 'apps/web can use token-based Tailwind classes like bg-primary and text-foreground'
    - "Adding class='dark' to html element switches all semantic tokens to dark values"
    - 'Dark mode toggle persists preference to localStorage'
    - 'Page loads without flash of wrong theme'
    - 'OS prefers-color-scheme is respected as default'
  artifacts:
    - path: 'apps/web/src/index.css'
      provides: 'Token CSS imports and @theme directive mapping'
      contains: '@theme'
    - path: 'apps/web/index.html'
      provides: 'Flash-of-wrong-theme prevention script'
      contains: 'localStorage'
    - path: 'apps/web/src/components/theme-toggle.tsx'
      provides: 'Dark mode toggle component'
      contains: 'toggleTheme'
  key_links:
    - from: 'apps/web/src/index.css'
      to: '@phoenix/tokens/dist/tokens.css'
      via: 'CSS @import'
      pattern: '@import.*tokens'
    - from: 'apps/web/src/index.css'
      to: '@phoenix/tokens/dist/tokens.dark.css'
      via: 'CSS @import'
      pattern: '@import.*dark'
    - from: 'apps/web/src/components/theme-toggle.tsx'
      to: 'document.documentElement.classList'
      via: 'DOM class toggle'
      pattern: 'classList.toggle.*dark'
    - from: 'apps/web/index.html'
      to: 'localStorage'
      via: 'inline script reading theme preference'
      pattern: 'localStorage.getItem.*theme'
---

<objective>
Wire the generated design tokens into apps/web via Tailwind CSS v4's @theme directive and implement dark mode with a toggle component.

Purpose: This makes the token system usable -- developers can write `bg-primary text-foreground` in components and get the design system's curated colors. Dark mode "just works" with a class toggle.

Output: Tailwind @theme configuration consuming token CSS, flash-prevention script, dark mode toggle component, updated welcome page demonstrating tokens.
</objective>

<execution_context>
@/Users/chris/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-token-system/02-CONTEXT.md
@.planning/phases/02-token-system/02-RESEARCH.md
@.planning/phases/02-token-system/02-01-SUMMARY.md
@apps/web/src/App.tsx
@apps/web/index.html
@packages/tokens/dist/tokens.css
@packages/tokens/dist/tokens.dark.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire token CSS into Tailwind v4 and add dark mode toggle</name>
  <files>
    apps/web/src/index.css
    apps/web/index.html
    apps/web/src/components/theme-toggle.tsx
    apps/web/src/App.tsx
    apps/web/package.json
  </files>
  <action>
**apps/web/package.json:**
- Ensure @phoenix/tokens is listed as a dependency (workspace:*)

**apps/web/src/index.css:**
Replace current contents with Tailwind v4 CSS-first configuration:

```css
@import 'tailwindcss';
@import '@phoenix/tokens/dist/tokens.css';
@import '@phoenix/tokens/dist/tokens.dark.css';

@theme {
  /* Map semantic color tokens to Tailwind color utilities */
  --color-background: var(--color-semantic-background);
  --color-foreground: var(--color-semantic-foreground);
  --color-card: var(--color-semantic-card);
  --color-card-foreground: var(--color-semantic-card-foreground);
  --color-primary: var(--color-semantic-primary);
  --color-primary-foreground: var(--color-semantic-primary-foreground);
  --color-secondary: var(--color-semantic-secondary);
  --color-secondary-foreground: var(--color-semantic-secondary-foreground);
  --color-muted: var(--color-semantic-muted);
  --color-muted-foreground: var(--color-semantic-muted-foreground);
  --color-accent: var(--color-semantic-accent);
  --color-accent-foreground: var(--color-semantic-accent-foreground);
  --color-destructive: var(--color-semantic-destructive);
  --color-destructive-foreground: var(--color-semantic-destructive-foreground);
  --color-border: var(--color-semantic-border);
  --color-input: var(--color-semantic-input);
  --color-ring: var(--color-semantic-ring);

  /* Map spacing tokens */
  /* Map typography tokens */
  /* Map radius tokens */

  /* Also map full color scales for direct use (e.g., bg-neutral-500) */
}
```

IMPORTANT: The exact CSS variable names in the @theme block depend on what Style Dictionary generates. Read the actual dist/tokens.css file from Plan 01's output to get the real variable names. Style Dictionary transforms token paths like `color.neutral.50` into CSS variables like `--color-neutral-50` (using the css transformGroup). Map these correctly.

The @theme directive tells Tailwind v4 which CSS variables become utility classes. `--color-primary: var(--color-semantic-primary)` means `bg-primary` and `text-primary` will work.

**apps/web/index.html:**
Add flash-of-wrong-theme inline script in the `<head>`, BEFORE any other scripts:

```html
<script>
  ;(function () {
    const stored = localStorage.getItem('theme')
    const prefersDark = window.matchMedia(
      '(prefers-color-scheme: dark)',
    ).matches
    const theme = stored || (prefersDark ? 'dark' : 'light')
    if (theme === 'dark') {
      document.documentElement.classList.add('dark')
    }
  })()
</script>
```

**apps/web/src/components/theme-toggle.tsx:**
Create dark mode toggle component:

- useState for current theme ('light' | 'dark')
- useEffect on mount: read from localStorage, fall back to matchMedia prefers-color-scheme
- Toggle function: flip theme, update localStorage, toggle .dark class on document.documentElement
- Render a button with sun/moon text (no emoji -- use text like "Light" / "Dark" or SVG icons)
- aria-label for accessibility

**apps/web/src/App.tsx:**
Update the welcome/home page to:

- Import and render ThemeToggle component
- Use token-based Tailwind classes to demonstrate the system: bg-background, text-foreground, bg-primary, text-primary-foreground, bg-card, border-border, etc.
- Show a simple demo layout: heading, paragraph, a colored card, a "primary" styled button, the theme toggle
- This serves as visual proof the token system works
  </action>
  <verify> - `pnpm dev` from root starts without errors - Visit localhost:5173 -- page renders with token-based colors - Inspect element: CSS variables from tokens.css are applied - Click theme toggle: colors switch to dark mode values - Refresh page in dark mode: no flash of light theme (inline script works) - Open new incognito window: theme defaults to OS preference - `pnpm turbo run build` succeeds from root - `pnpm turbo run typecheck` passes
  </verify>
  <done>
  apps/web consumes design tokens via Tailwind v4 @theme directive. Utility classes like bg-primary and text-foreground render correct token colors. Dark mode toggle switches themes, persists to localStorage, respects OS preference, and loads without flash.
  </done>
  </task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete token system with Tailwind v4 integration and dark mode toggle in apps/web. The page should display token-based colors that switch correctly between light and dark themes.
  </what-built>
  <how-to-verify>
    1. Run `pnpm dev` from repo root
    2. Visit http://localhost:5173
    3. Verify the page uses design system colors (not default browser styles)
    4. Click the theme toggle -- all colors should switch to dark mode values
    5. Refresh the page while in dark mode -- should NOT flash white before going dark
    6. Open browser DevTools, inspect any element, verify CSS variables are from the token system (--color-semantic-background, etc.)
    7. In DevTools, manually toggle the "dark" class on the html element -- colors should respond
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues with the token system / dark mode behavior</resume-signal>
</task>

</tasks>

<verification>
1. `pnpm turbo run build` succeeds (tokens build, then web build)
2. `pnpm turbo run typecheck` passes all packages
3. Token-based Tailwind classes (bg-primary, text-foreground, etc.) render correctly
4. Dark mode class toggle switches all semantic tokens
5. Theme persists across page refresh via localStorage
6. No flash of wrong theme on page load
7. OS prefers-color-scheme respected as default
</verification>

<success_criteria>

- apps/web renders with token-based colors via Tailwind utility classes
- Toggling .dark class switches all semantic tokens to dark values
- Theme toggle component works with localStorage persistence
- No flash of wrong theme on load (inline script protection)
- Full monorepo build and typecheck pass
  </success_criteria>

<output>
After completion, create `.planning/phases/02-token-system/02-02-SUMMARY.md`
</output>
