---
phase: 04-documentation-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/storybook/package.json
  - apps/storybook/tsconfig.json
  - apps/storybook/.storybook/main.ts
  - apps/storybook/.storybook/preview.ts
  - apps/storybook/stories/Tokens.mdx
autonomous: true

must_haves:
  truths:
    - 'Storybook dev server starts and renders at localhost:6006'
    - 'Tailwind CSS classes render correctly in Storybook stories'
    - 'Dark mode toggle in Storybook toolbar switches theme class'
    - 'Tokens overview page shows color swatches, spacing, typography, and radii sections'
  artifacts:
    - path: 'apps/storybook/.storybook/main.ts'
      provides: 'Storybook config with Vite builder and Tailwind CSS 4 integration'
      contains: 'viteFinal'
    - path: 'apps/storybook/.storybook/preview.ts'
      provides: 'Global decorators with theme switching and CSS import'
      contains: 'withThemeByClassName'
    - path: 'apps/storybook/stories/Tokens.mdx'
      provides: 'Token visualization page with colors, spacing, typography, radii'
      contains: 'Design Tokens'
    - path: 'apps/storybook/package.json'
      provides: 'Storybook dependencies and dev/build scripts'
      contains: 'storybook'
  key_links:
    - from: 'apps/storybook/.storybook/preview.ts'
      to: '@phoenix/ui styles'
      via: 'CSS import'
      pattern: "import.*index\\.css"
    - from: 'apps/storybook/.storybook/main.ts'
      to: '@tailwindcss/vite'
      via: 'viteFinal async import'
      pattern: 'await import.*tailwindcss/vite'
---

<objective>
Set up Storybook 10.1 app in apps/storybook with Vite builder, Tailwind CSS 4 integration, dark mode theme switching, and a tokens overview documentation page.

Purpose: Establishes the documentation infrastructure that all component stories depend on. The tokens page provides immediate visual validation of the design token system.
Output: Working Storybook dev server with theme toggle and tokens visualization page.
</objective>

<execution_context>
@/Users/chris/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-documentation-infrastructure/04-RESEARCH.md

Key existing files:

- apps/storybook/package.json (stub - has @phoenix/typescript-config only)
- apps/storybook/tsconfig.json (extends react.json, includes src/)
- apps/web/src/index.css (reference for @theme mapping and token imports)
- packages/ui/src/index.ts (barrel export for all components)
- packages/ui/package.json (peer deps: react 18.3.0, radix-ui packages)
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Storybook app with Vite builder and Tailwind CSS 4</name>
  <files>
    apps/storybook/package.json
    apps/storybook/tsconfig.json
    apps/storybook/.storybook/main.ts
    apps/storybook/.storybook/preview.ts
  </files>
  <action>
    1. Update apps/storybook/package.json:
       - Add devDependencies: storybook@^10.1.0, @storybook/react-vite@^10.1.0, @storybook/addon-essentials@^10.1.0, @storybook/addon-themes@latest, @storybook/blocks@^10.1.0, @tailwindcss/vite@^4.0.0, react@18.3.0, react-dom@18.3.0, @types/react@^18.3.0, @types/react-dom@^18.3.0, typescript@^5.0.0, vite@^7.0.0
       - Add dependency on @phoenix/ui (workspace:*) and @phoenix/tokens (workspace:*)
       - Update scripts: "dev": "storybook dev -p 6006", "build": "storybook build"
       - Keep existing @phoenix/typescript-config dependency

    2. Update apps/storybook/tsconfig.json:
       - Extend @phoenix/typescript-config/react.json
       - Include both "src" and "stories" directories, plus ".storybook"
       - Add compilerOptions with jsx: "react-jsx" if not inherited

    3. Create apps/storybook/.storybook/main.ts:
       - Use StorybookConfig type from @storybook/react-vite
       - stories glob: ['../stories/**/*.mdx', '../stories/**/*.stories.@(js|jsx|ts|tsx)']
       - addons: ['@storybook/addon-essentials', '@storybook/addon-themes']
       - framework: { name: '@storybook/react-vite', options: {} }
       - viteFinal hook with async dynamic import for @tailwindcss/vite (ESM-only package):
         ```
         async viteFinal(config) {
           const { default: tailwindcss } = await import('@tailwindcss/vite')
           const { mergeConfig } = await import('vite')
           return mergeConfig(config, { plugins: [tailwindcss()] })
         }
         ```
       - Note: CJS deprecation warning is expected and cosmetic (Pitfall 1 from research)

    4. Create apps/storybook/.storybook/preview.ts:
       - Import withThemeByClassName from @storybook/addon-themes
       - Import Preview type from @storybook/react
       - CRITICAL: Create a CSS file at apps/storybook/stories/index.css that mirrors apps/web/src/index.css (same @import 'tailwindcss', same token imports, same @theme block). Import this CSS file instead of importing from @phoenix/ui/src/index.css (the UI package has no index.css). Read apps/web/src/index.css to get the full @theme mapping.
       - Configure withThemeByClassName decorator with themes: { light: '', dark: 'dark' }, defaultTheme: 'light'
       - Add controls matchers for color and date patterns

    5. Run `pnpm install` from repo root to install new dependencies.

    IMPORTANT: The UI package does NOT have an index.css file. The CSS with token imports and @theme mapping lives in apps/web/src/index.css. You must duplicate this CSS setup for the Storybook app (same pattern: import tailwindcss, import token CSS files, define @theme mappings).

  </action>
  <verify>
    - Run `pnpm --filter @phoenix/storybook dev` and confirm Storybook starts on port 6006 (may show welcome page or empty state)
    - Check no TypeScript errors: `pnpm --filter @phoenix/storybook exec tsc --noEmit` (or check the build step)
    - Verify .storybook/main.ts and .storybook/preview.ts exist with correct content
  </verify>
  <done>
    Storybook dev server starts on localhost:6006, viteFinal loads @tailwindcss/vite plugin, theme toggle appears in toolbar for light/dark switching, and Tailwind CSS classes from the token system render correctly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create tokens overview MDX page</name>
  <files>
    apps/storybook/stories/Tokens.mdx
  </files>
  <action>
    Create apps/storybook/stories/Tokens.mdx as a standalone documentation page:

    1. Import Meta from @storybook/blocks
    2. Set Meta title to "Design System/Tokens"
    3. Structure as single scrollable page with these sections:

    **Colors section:**
    - Grid layout showing semantic color swatches
    - Each swatch: colored rectangle using Tailwind utility (e.g., bg-background, bg-primary, bg-secondary, etc.)
    - Below each: semantic token name (bold) + CSS variable name (code)
    - Cover: background/foreground, card/card-foreground, primary/primary-foreground, secondary/secondary-foreground, muted/muted-foreground, accent/accent-foreground, destructive/destructive-foreground, border, input, ring
    - Use only CSS variable-based classes (bg-background, bg-primary, etc.) so they respond to theme toggle automatically
    - Do NOT use dark: classes (Pitfall 3 from research)

    **Spacing section:**
    - Visual boxes showing relative sizes at each scale value
    - Each row: colored box with width proportional to spacing value + label showing name and px value
    - Show key spacing values: 1 (4px), 2 (8px), 3 (12px), 4 (16px), 5 (20px), 6 (24px), 8 (32px), 10 (40px), 12 (48px), 16 (64px)
    - Use bg-primary for the visual boxes

    **Typography section:**
    - Sample text at each type scale: text-xs, text-sm, text-base, text-lg, text-xl, text-2xl, text-3xl
    - Each sample shows: label (muted) + "The quick brown fox jumps over the lazy dog"
    - Use font-sans for all samples

    **Border Radius section:**
    - Grid of boxes with different border radii: rounded-sm, rounded, rounded-md, rounded-lg, rounded-xl, rounded-2xl, rounded-full
    - Each box: bg-muted with the radius applied + label below

    All colors use semantic token Tailwind classes (bg-background, text-foreground, etc.) to automatically respond to the dark mode toggle. No hardcoded hex values.

  </action>
  <verify>
    - Confirm apps/storybook/stories/Tokens.mdx exists
    - Start Storybook and navigate to "Design System > Tokens" in the sidebar
    - Toggle dark mode and confirm swatches change colors
  </verify>
  <done>
    Tokens MDX page renders in Storybook sidebar under "Design System/Tokens" showing colors, spacing, typography, and border radius sections. All color swatches respond to theme toggle.
  </done>
</task>

</tasks>

<verification>
1. `pnpm --filter @phoenix/storybook dev` starts Storybook on port 6006
2. Theme toggle in toolbar switches between light and dark modes
3. Tokens page visible in sidebar under "Design System/Tokens"
4. Token color swatches change when toggling dark mode
5. No TypeScript compilation errors in apps/storybook
</verification>

<success_criteria>

- Storybook dev server runs at localhost:6006
- Dark mode toggle works via @storybook/addon-themes toolbar
- Tokens overview page displays all 4 sections (Colors, Spacing, Typography, Border Radius)
- Tailwind CSS 4 classes render correctly (semantic tokens from @theme)
- DOCS-01 partially satisfied (Storybook running, components not yet documented)
- DOCS-03 fully satisfied (tokens overview page complete)
  </success_criteria>

<output>
After completion, create `.planning/phases/04-documentation-infrastructure/04-01-SUMMARY.md`
</output>
