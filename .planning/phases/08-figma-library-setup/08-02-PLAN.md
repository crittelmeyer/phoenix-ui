---
phase: 08-figma-library-setup
plan: 02
type: execute
wave: 2
depends_on: ['08-01']
files_modified: []
autonomous: false

user_setup:
  - service: figma
    why: 'Design tool for UI components and Variables'
    account_required: 'Figma Professional plan (for Variable modes)'
    dashboard_config:
      - task: 'Duplicate community kit file'
        location: "Figma Community > search 'shadcn/ui Design System'"
  - service: tokens-studio
    why: 'Design token management plugin'
    account_required: 'Tokens Studio Pro (for multi-file sync and Themes)'
    dashboard_config:
      - task: 'Install Tokens Studio plugin'
        location: "Figma > Plugins > Browse > 'Tokens Studio'"
  - service: github
    why: 'Repository sync for bidirectional token workflow'
    env_vars:
      - name: GITHUB_PAT
        source: 'GitHub > Settings > Developer settings > Personal access tokens > Fine-grained tokens'
        scopes: 'Contents: Read and write (for packages/tokens/src/tokens only)'

must_haves:
  truths:
    - "Community Figma kit is duplicated to user's account"
    - 'Tokens Studio plugin is installed and connected to GitHub'
    - 'Tokens from code are visible in Figma plugin'
    - 'Figma Variables exist with Light and Dark modes'
  artifacts:
    - path: 'Figma file: Phoenix Design System'
      provides: 'Component library with Variables'
    - path: 'packages/tokens/src/tokens/$themes.json'
      provides: 'Theme definitions updated with Figma collection IDs'
      contains: '$figmaCollectionId'
  key_links:
    - from: 'Tokens Studio plugin'
      to: 'GitHub repo packages/tokens/src/tokens'
      via: 'Personal Access Token authentication'
    - from: 'Tokens Studio themes'
      to: 'Figma Variable modes'
      via: 'Export to Variables'
---

<objective>
Configure Figma library with Tokens Studio and GitHub sync

Purpose: Establish the Figma side of the bidirectional token workflow. Designer can pull code tokens into Figma, and changes in Figma can be pushed back to code.

Output: Working Figma library file with Phoenix tokens applied via Figma Variables
</objective>

<execution_context>
@/Users/chris/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/08-figma-library-setup/08-RESEARCH.md
@.planning/phases/08-figma-library-setup/08-CONTEXT.md
@.planning/phases/08-figma-library-setup/08-01-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Duplicate community kit and install Tokens Studio</name>
  <action>
User must perform these steps in Figma (cannot be automated):

**Step 1: Duplicate the community kit**

1. Go to https://www.figma.com/community/file/1314057472629730742/shadcn-ui-design-system-variables-theming
2. Click "Open in Figma" to duplicate to your account
3. Rename the file to "Phoenix Design System"
4. Move to your team project if applicable

**Step 2: Install Tokens Studio plugin**

1. In Figma, go to Resources (Shift+I) > Plugins
2. Search for "Tokens Studio for Figma"
3. Click "Run" to install/open the plugin
4. If prompted, select "Open plugin"

**Step 3: Create GitHub Personal Access Token**

1. Go to https://github.com/settings/tokens?type=beta (Fine-grained tokens)
2. Click "Generate new token"
3. Name: "Tokens Studio - Phoenix"
4. Expiration: 90 days (or maximum allowed)
5. Repository access: Only select repositories > select your phoenix repo
6. Permissions:
   - Contents: Read and write
   - Metadata: Read-only (required)
7. Click "Generate token"
8. Copy the token immediately (shown only once)

**Step 4: Configure Tokens Studio GitHub sync**

1. In Tokens Studio plugin panel, click Settings (gear icon)
2. Under "Sync providers", click "Add new" > "GitHub"
3. Enter:
   - Name: Phoenix Tokens
   - Personal Access Token: [paste token from Step 3]
   - Repository: [your-username]/phoenix
   - Branch: main
   - File Path: packages/tokens/src/tokens
4. Click "Save"
5. Click "Pull from GitHub" to load tokens
   </action>
   <resume-signal>
   Confirm completion by typing one of:

- "tokens loaded" - Tokens Studio shows token sets (colors, spacing, typography, radii)
- "error: [description]" - Something failed, describe the error
  </resume-signal>
  </task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Configure themes and export to Figma Variables</name>
  <action>
With tokens loaded in Tokens Studio, now configure themes and export to Variables:

**Step 1: Verify token sets loaded**
Check the left panel shows these token sets:

- colors
- colors.dark
- spacing
- typography
- radii

**Step 2: Configure themes (requires Pro)**

1. Click the "Themes" tab in Tokens Studio
2. You should see two themes from $themes.json:
   - Phoenix Light
   - Phoenix Dark
3. If themes aren't showing:
   - Click "Create theme group" > name it "Phoenix"
   - Create theme "phoenix-light" with: colors + spacing + typography + radii enabled
   - Create theme "phoenix-dark" with: colors (source) + colors.dark + spacing + typography + radii enabled

**Step 3: Set token format to DTCG**

1. Click Settings (gear icon)
2. Under "Token Format", select "W3C DTCG"
3. This ensures $value, $type, $description format

**Step 4: Export to Figma Variables**

1. Click "Styles & Variables" in bottom toolbar
2. Click "Export styles & variables"
3. Select "Export from Themes"
4. Enable Variables for: Color, Number, String
5. Click "Export"
6. Confirm the export completes

**Step 5: Verify Variables created**

1. Open Figma's Variables panel (right sidebar > Local variables)
2. You should see collections:
   - colors (or similar) with Light and Dark modes
   - spacing
   - typography
   - radii
3. Each collection should have variables matching token names
   </action>
   <resume-signal>
   Confirm completion by typing one of:

- "variables exported" - Figma Variables panel shows collections with Light/Dark modes
- "pro required" - Multi-file or themes feature needs Pro upgrade
- "error: [description]" - Export failed, describe the error
  </resume-signal>
  </task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 3: Push sync configuration back to code</name>
  <action>
After exporting Variables, Tokens Studio updates $themes.json with Figma collection IDs. Push these changes back to git:

**Step 1: Push to GitHub**

1. In Tokens Studio, click the sync icon (circular arrows)
2. Click "Push to GitHub"
3. Enter commit message: "chore(tokens): sync Figma collection IDs"
4. Click "Push"

**Step 2: Verify push succeeded**

1. Go to your GitHub repo
2. Check packages/tokens/src/tokens/$themes.json
3. The file should now have populated $figmaCollectionId and $figmaModeId values

**Step 3: Pull changes to local**
In your terminal:

```bash
cd /path/to/phoenix
git pull origin main
```

This syncs the Figma collection IDs back to your local codebase.
</action>
<resume-signal>
Confirm completion by typing one of:

- "pushed and pulled" - Changes are in GitHub and pulled locally
- "branch protected" - Push failed due to branch protection (will use PR workflow)
- "error: [description]" - Push failed, describe the error
  </resume-signal>
  </task>

</tasks>

<verification>
- [ ] Phoenix Design System file exists in Figma
- [ ] Tokens Studio plugin shows 5 token sets
- [ ] GitHub sync is configured and working
- [ ] Figma Variables panel shows color/spacing/typography/radii collections
- [ ] Light and Dark modes exist in color Variables
- [ ] $themes.json in code has $figmaCollectionId populated
</verification>

<success_criteria>
Figma library is fully configured:

1. Community kit duplicated and renamed to Phoenix Design System
2. Tokens Studio connected to GitHub with bidirectional sync
3. All tokens exported to Figma Variables with Light/Dark modes
4. Sync configuration (collection IDs) committed back to code
   </success_criteria>

<output>
After completion, create `.planning/phases/08-figma-library-setup/08-02-SUMMARY.md`
</output>
