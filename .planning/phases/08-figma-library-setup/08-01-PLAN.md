---
phase: 08-figma-library-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/tokens/src/tokens/$metadata.json
  - packages/tokens/src/tokens/$themes.json
  - .github/workflows/validate-tokens.yml
autonomous: true

must_haves:
  truths:
    - 'Token source files are in Tokens Studio compatible format'
    - 'GitHub Actions validates token changes on PR'
    - 'Theme configuration maps light/dark token sets'
  artifacts:
    - path: 'packages/tokens/src/tokens/$metadata.json'
      provides: 'Token set ordering and configuration'
      contains: 'tokenSetOrder'
    - path: 'packages/tokens/src/tokens/$themes.json'
      provides: 'Light and dark theme definitions'
      contains: 'phoenix-light'
    - path: '.github/workflows/validate-tokens.yml'
      provides: 'CI validation for token changes'
      contains: 'pnpm build'
  key_links:
    - from: 'packages/tokens/src/tokens/$themes.json'
      to: 'packages/tokens/src/tokens/colors.json'
      via: 'token set reference'
      pattern: 'colors'
---

<objective>
Prepare codebase for Tokens Studio GitHub sync

Purpose: Tokens Studio requires specific metadata files to recognize the token repository structure. This plan adds the required configuration files that Tokens Studio expects when syncing to a folder of JSON files.

Output: Token source directory ready for Tokens Studio import, plus CI validation workflow
</objective>

<execution_context>
@/Users/chris/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-figma-library-setup/08-RESEARCH.md
@.planning/phases/08-figma-library-setup/08-CONTEXT.md
@packages/tokens/src/tokens/colors.json
@packages/tokens/src/tokens/colors.dark.json
@packages/tokens/src/tokens/spacing.json
@packages/tokens/src/tokens/typography.json
@packages/tokens/src/tokens/radii.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Tokens Studio metadata files</name>
  <files>
    packages/tokens/src/tokens/$metadata.json
    packages/tokens/src/tokens/$themes.json
  </files>
  <action>
Create two metadata files that Tokens Studio requires for multi-file sync:

**$metadata.json** - Defines token set order and structure:

```json
{
  "tokenSetOrder": ["colors", "colors.dark", "spacing", "typography", "radii"]
}
```

**$themes.json** - Defines theme configurations matching existing token sets:

```json
[
  {
    "id": "phoenix-light",
    "name": "Phoenix Light",
    "$figmaStyleReferences": {},
    "selectedTokenSets": {
      "colors": "enabled",
      "spacing": "enabled",
      "typography": "enabled",
      "radii": "enabled"
    },
    "$figmaCollectionId": "",
    "$figmaModeId": ""
  },
  {
    "id": "phoenix-dark",
    "name": "Phoenix Dark",
    "$figmaStyleReferences": {},
    "selectedTokenSets": {
      "colors": "source",
      "colors.dark": "enabled",
      "spacing": "enabled",
      "typography": "enabled",
      "radii": "enabled"
    },
    "$figmaCollectionId": "",
    "$figmaModeId": ""
  }
]
```

Key points:

- Token set names match existing JSON filenames (without .json extension)
- For dark theme, "colors" is "source" (base values) and "colors.dark" is "enabled" (overrides)
- $figmaCollectionId and $figmaModeId will be populated by Tokens Studio after first Variable export
- These files use Legacy format for Tokens Studio compatibility (not DTCG)
  </action>
  <verify>

```bash
# Files exist
ls -la packages/tokens/src/tokens/\$metadata.json packages/tokens/src/tokens/\$themes.json

# Valid JSON
cat packages/tokens/src/tokens/\$metadata.json | jq .
cat packages/tokens/src/tokens/\$themes.json | jq .

# Token sets match existing files
ls packages/tokens/src/tokens/*.json | grep -v '\$'
```

  </verify>
  <done>$metadata.json and $themes.json exist with correct token set references matching existing files</done>
</task>

<task type="auto">
  <name>Task 2: Create GitHub Actions token validation workflow</name>
  <files>.github/workflows/validate-tokens.yml</files>
  <action>
Create a workflow that validates token changes pushed via Tokens Studio sync:

```yaml
name: Validate Tokens

on:
  push:
    paths:
      - 'packages/tokens/src/tokens/**'
  pull_request:
    paths:
      - 'packages/tokens/src/tokens/**'

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 10

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'
          cache: 'pnpm'

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Build tokens
        run: pnpm --filter @phoenix/tokens build

      - name: Verify outputs exist
        run: |
          test -f packages/tokens/dist/tokens.css
          test -f packages/tokens/dist/tokens.dark.css
          test -f packages/tokens/dist/figma/light.json
          test -f packages/tokens/dist/figma/dark.json
          echo "All token outputs generated successfully"
```

This workflow:

- Triggers only when token files change (not on every push)
- Runs full token build to catch format/reference errors
- Validates both CSS and Figma outputs are generated
- Blocks merging if tokens are invalid
  </action>
  <verify>

```bash
# Workflow file exists
ls -la .github/workflows/validate-tokens.yml

# Valid YAML
cat .github/workflows/validate-tokens.yml | head -20

# Actions reference correct paths
grep -c "packages/tokens" .github/workflows/validate-tokens.yml
```

  </verify>
  <done>GitHub Actions workflow validates token builds on push to packages/tokens/src/tokens/</done>
</task>

<task type="auto">
  <name>Task 3: Verify token build still works with new files</name>
  <files>packages/tokens/dist/figma/light.json</files>
  <action>
Run the token build to ensure the new metadata files don't break the existing build:

```bash
cd packages/tokens && pnpm build
```

The build should complete without errors. The $metadata.json and $themes.json files should be ignored by Style Dictionary (it only processes token files, not Tokens Studio metadata).

If the build fails, check that:

1. $metadata.json and $themes.json are valid JSON
2. Style Dictionary isn't trying to parse the $ prefixed files as tokens
3. The existing token files (colors.json, etc.) are unchanged

After build, verify outputs match expected structure.
</action>
<verify>

```bash
# Run build
cd packages/tokens && pnpm build

# Verify outputs exist
ls -la dist/tokens.css dist/tokens.dark.css dist/figma/light.json dist/figma/dark.json

# Verify build outputs are not empty
test -s dist/tokens.css && echo "CSS output OK"
test -s dist/figma/light.json && echo "Figma light output OK"
```

  </verify>
  <done>Token build completes successfully with new metadata files present</done>
</task>

</tasks>

<verification>
- [ ] $metadata.json exists with correct tokenSetOrder
- [ ] $themes.json exists with phoenix-light and phoenix-dark themes
- [ ] validate-tokens.yml workflow created
- [ ] Token build succeeds without errors
- [ ] All existing outputs (CSS, Figma JSON) still generated correctly
</verification>

<success_criteria>
Token source directory is Tokens Studio-ready:

1. Metadata files signal folder structure to Tokens Studio plugin
2. Theme definitions ready for light/dark mode Variable export
3. CI workflow will validate any token changes pushed via sync
4. Existing build pipeline unaffected
   </success_criteria>

<output>
After completion, create `.planning/phases/08-figma-library-setup/08-01-SUMMARY.md`
</output>
