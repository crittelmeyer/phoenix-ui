---
phase: 08-figma-library-setup
plan: 03
type: execute
wave: 3
depends_on: ['08-02']
files_modified:
  - packages/tokens/src/tokens/colors.json
autonomous: false

must_haves:
  truths:
    - 'Token changes in code appear in Figma after sync'
    - 'Variable changes in Figma can be pushed to code'
    - 'Style Dictionary build succeeds with synced tokens'
  artifacts:
    - path: 'packages/tokens/dist/figma/light.json'
      provides: 'Rebuilt Figma tokens with test change'
    - path: 'packages/tokens/dist/tokens.css'
      provides: 'Rebuilt CSS with test change'
  key_links:
    - from: 'Tokens Studio plugin'
      to: 'packages/tokens/src/tokens/*.json'
      via: 'GitHub sync pull/push'
    - from: 'packages/tokens/src/tokens/*.json'
      to: 'packages/tokens/dist/*'
      via: 'Style Dictionary build'
---

<objective>
Verify bidirectional token sync workflow

Purpose: Confirm the complete workflow works end-to-end: code to Figma, and Figma back to code. This validates that the infrastructure is ready for ongoing design-development collaboration.

Output: Verified bidirectional sync with test token change round-trip
</objective>

<execution_context>
@/Users/chris/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/08-figma-library-setup/08-RESEARCH.md
@.planning/phases/08-figma-library-setup/08-02-SUMMARY.md
@packages/tokens/src/tokens/colors.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make test token change in code</name>
  <files>packages/tokens/src/tokens/colors.json</files>
  <action>
Add a test token to colors.json to verify code-to-Figma sync:

1. Read packages/tokens/src/tokens/colors.json
2. Add a new test color in the color object (at the end, before closing brace):

```json
"test": {
  "sync-verification": {
    "$value": "oklch(0.7 0.15 150)",
    "$type": "color",
    "$description": "Temporary token to verify Figma sync - delete after verification"
  }
}
```

3. Run token build to verify the change doesn't break anything:

```bash
cd packages/tokens && pnpm build
```

4. Commit the change:

```bash
git add packages/tokens/src/tokens/colors.json
git commit -m "test(08-03): add sync verification token"
git push origin main
```

  </action>
  <verify>
```bash
# Token added
grep -A4 "sync-verification" packages/tokens/src/tokens/colors.json

# Build succeeds

cd packages/tokens && pnpm build && echo "Build OK"

# Token appears in Figma output (as hex)

grep "sync-verification" packages/tokens/dist/figma/light.json

````
  </verify>
  <done>Test token added to colors.json, built, and pushed to GitHub</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify code-to-Figma sync</name>
  <what-built>Test token pushed to GitHub for Figma sync verification</what-built>
  <how-to-verify>
**Step 1: Pull changes in Tokens Studio**
1. Open your Phoenix Design System Figma file
2. Open Tokens Studio plugin
3. Click the sync icon (circular arrows)
4. Click "Pull from GitHub"
5. Confirm changes are pulled

**Step 2: Verify test token appears**
1. In Tokens Studio, expand the "colors" token set
2. Look for "test" > "sync-verification"
3. The value should show as a greenish color (converted from OKLCH)

**Step 3: Export to Variables (optional)**
1. If you want to see it in Variables, export again:
   - Styles & Variables > Export > Export from Themes
2. Check Figma Variables panel for color/test/sync-verification

**Expected result:** The test token from code appears in Tokens Studio within 30 seconds of pulling.
  </how-to-verify>
  <resume-signal>
Confirm by typing one of:
- "token synced" - Test token appears in Tokens Studio
- "not found" - Token didn't appear after pull (describe what you see)
  </resume-signal>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 3: Test Figma-to-code sync</name>
  <action>
Now test the reverse direction - make a change in Figma and push to code:

**Step 1: Modify the test token in Tokens Studio**
1. In Tokens Studio, find colors > test > sync-verification
2. Click to edit
3. Change the color value to a different hex (e.g., #ff6b6b - a coral red)
4. Click Save

**Step 2: Push to GitHub**
1. Click the sync icon
2. Click "Push to GitHub"
3. Commit message: "test: modify sync verification token from Figma"
4. Click Push

**Step 3: Verify in code**
In terminal:
```bash
cd /path/to/phoenix
git pull origin main
cat packages/tokens/src/tokens/colors.json | grep -A3 "sync-verification"
````

**Expected result:** The token value in code should now be the hex value you set in Figma (e.g., "#ff6b6b"), not the original OKLCH.

**Note:** This confirms Figma-to-code sync works. The hex format is expected - OKLCH is not supported in Tokens Studio.
</action>
<resume-signal>
Confirm by typing one of:

- "sync works" - The modified value appears in code after pull
- "push failed: [error]" - Describe the push error
- "no change in code" - Pull succeeded but file unchanged
  </resume-signal>
  </task>

<task type="auto">
  <name>Task 4: Clean up test token and rebuild</name>
  <files>packages/tokens/src/tokens/colors.json</files>
  <action>
Remove the test token now that sync is verified:

1. Pull latest changes (in case Figma pushed updates):

```bash
git pull origin main
```

2. Read packages/tokens/src/tokens/colors.json
3. Remove the entire "test" object that was added:

```json
"test": {
  "sync-verification": {
    ...
  }
}
```

4. Rebuild tokens:

```bash
cd packages/tokens && pnpm build
```

5. Commit cleanup:

```bash
git add packages/tokens/src/tokens/colors.json packages/tokens/dist/
git commit -m "chore(08-03): remove sync verification test token"
git push origin main
```

6. Optionally, in Tokens Studio, pull again to sync the removal.
   </action>
   <verify>

```bash
# Test token removed
grep "sync-verification" packages/tokens/src/tokens/colors.json || echo "Token removed OK"

# Build still works
cd packages/tokens && pnpm build && echo "Build OK"
```

  </verify>
  <done>Test token removed, build verified, cleanup committed</done>
</task>

</tasks>

<verification>
- [ ] Test token added to code and pushed
- [ ] Token appeared in Tokens Studio after pull
- [ ] Modified token pushed from Figma to code
- [ ] Test token removed and build still works
- [ ] Bidirectional sync confirmed working
</verification>

<success_criteria>
Bidirectional sync is verified:

1. Code changes (OKLCH) sync to Figma (as hex) via Tokens Studio pull
2. Figma changes push back to code via Tokens Studio
3. Style Dictionary build works with synced tokens
4. Clean state restored after verification
   </success_criteria>

<output>
After completion, create `.planning/phases/08-figma-library-setup/08-03-SUMMARY.md`
</output>
