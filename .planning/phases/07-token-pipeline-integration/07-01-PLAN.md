---
phase: 07-token-pipeline-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/tokens/package.json
  - packages/tokens/src/formats/tokens-studio.mjs
  - packages/tokens/src/formats/token-mapping.mjs
  - packages/tokens/src/formats/color-comparison.mjs
autonomous: true

must_haves:
  truths:
    - '@tokens-studio/sd-transforms is installed as devDependency'
    - 'Custom formats exist for Tokens Studio JSON output'
    - 'Custom format exists for token mapping documentation'
    - 'Custom format exists for color comparison HTML'
  artifacts:
    - path: 'packages/tokens/package.json'
      provides: 'sd-transforms dependency'
      contains: '@tokens-studio/sd-transforms'
    - path: 'packages/tokens/src/formats/tokens-studio.mjs'
      provides: 'Tokens Studio JSON format'
      exports: ['tokensStudioFormat']
    - path: 'packages/tokens/src/formats/token-mapping.mjs'
      provides: 'Phoenix to Figma token mapping'
      exports: ['tokenMappingFormat']
    - path: 'packages/tokens/src/formats/color-comparison.mjs'
      provides: 'OKLCH vs RGB comparison HTML'
      exports: ['colorComparisonFormat']
  key_links:
    - from: 'src/formats/tokens-studio.mjs'
      to: 'dictionary.allTokens'
      via: 'Style Dictionary format API'
      pattern: "dictionary\\.allTokens"
---

<objective>
Install @tokens-studio/sd-transforms and create custom Style Dictionary formats for Figma token output.

Purpose: Establishes the foundation for Figma-compatible token generation. sd-transforms provides OKLCH-to-RGB conversion and Tokens Studio compatibility. Custom formats structure output for Figma import and documentation.

Output: sd-transforms installed, three custom format files ready for build script integration.
</objective>

<execution_context>
@/Users/chris/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-token-pipeline-integration/07-RESEARCH.md
@.planning/phases/07-token-pipeline-integration/07-CONTEXT.md
@packages/tokens/package.json
@packages/tokens/src/build.mjs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install sd-transforms dependency</name>
  <files>packages/tokens/package.json</files>
  <action>
Install @tokens-studio/sd-transforms with version constraint ^2.0.0 (required for Style Dictionary 5.x compatibility - version 1.x only works with SD 4.x).

Run from packages/tokens directory:

```bash
pnpm add -D @tokens-studio/sd-transforms@^2.0.0
```

Verify package.json devDependencies includes the new package. The color.js peer dependency should be automatically resolved by sd-transforms.
</action>
<verify>
Run `cat packages/tokens/package.json | grep sd-transforms` shows version ^2.0.0 or higher.
Run `pnpm ls @tokens-studio/sd-transforms --filter @phoenix/tokens` shows installed version.
</verify>
<done>@tokens-studio/sd-transforms ^2.0.0 is in devDependencies and installed.</done>
</task>

<task type="auto">
  <name>Task 2: Create Tokens Studio JSON format</name>
  <files>packages/tokens/src/formats/tokens-studio.mjs</files>
  <action>
Create the formats directory and tokens-studio.mjs custom format.

This format outputs Tokens Studio plugin-compatible JSON:

- Wraps tokens in named set (e.g., `{ "phoenix-light": { ... } }`)
- Uses slash separator for Figma hierarchy (color/semantic/primary)
- Includes type and description from DTCG source
- Values are already hex-converted by sd-transforms ts/color/modifiers transform

Pattern from research:

```javascript
export const tokensStudioFormat = ({ dictionary, options, file }) => {
  const tokenSet = {}

  dictionary.allTokens.forEach((token) => {
    // Use slash separator for Figma hierarchy
    const tokenPath = token.path.join('/')

    tokenSet[tokenPath] = {
      value: token.value, // Already transformed to hex
      type: token.$type,
      ...(token.$description && { description: token.$description }),
    }
  })

  // Wrap in token set name - different for light/dark
  const output = {
    [options.tokenSetName || 'phoenix']: tokenSet,
  }

  return JSON.stringify(output, null, 2)
}
```

The format must be registered with StyleDictionary.registerFormat() in build.mjs (next plan).
</action>
<verify>
File exists at packages/tokens/src/formats/tokens-studio.mjs.
Export named `tokensStudioFormat` is a function.
Node can import without errors: `node -e "import('./packages/tokens/src/formats/tokens-studio.mjs').then(m => console.log(typeof m.tokensStudioFormat))"`
</verify>
<done>tokens-studio.mjs exports tokensStudioFormat function that outputs Tokens Studio JSON structure.</done>
</task>

<task type="auto">
  <name>Task 3: Create token mapping and color comparison formats</name>
  <files>
    packages/tokens/src/formats/token-mapping.mjs
    packages/tokens/src/formats/color-comparison.mjs
  </files>
  <action>
Create two additional custom formats:

**token-mapping.mjs** - Documents Phoenix name to Figma path correspondence:

```javascript
export const tokenMappingFormat = ({ dictionary }) => {
  const mapping = {}

  dictionary.allTokens.forEach((token) => {
    const phoenixName = token.path.join('.') // color.semantic.primary
    const figmaPath = token.path.join('/') // color/semantic/primary

    mapping[phoenixName] = {
      figmaPath,
      type: token.$type,
      value: token.value, // Final hex value
    }
  })

  return JSON.stringify(mapping, null, 2)
}
```

**color-comparison.mjs** - Generates HTML report showing OKLCH vs RGB side-by-side:

```javascript
export const colorComparisonFormat = ({ dictionary }) => {
  const colorTokens = dictionary.allTokens.filter((t) => t.$type === 'color')

  const rows = colorTokens
    .map(
      (token) => `
    <tr>
      <td><code>${token.path.join('.')}</code></td>
      <td><code>${token.original.$value}</code></td>
      <td style="background: ${token.original.$value}; width: 60px; height: 30px;"></td>
      <td><code>${token.value}</code></td>
      <td style="background: ${token.value}; width: 60px; height: 30px;"></td>
    </tr>
  `,
    )
    .join('')

  return `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Phoenix Token Color Comparison</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
    h1 { color: #1a1a1a; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #f5f5f5; }
    code { font-family: monospace; font-size: 12px; }
    tr:hover { background: #f9f9f9; }
  </style>
</head>
<body>
  <h1>OKLCH to RGB Color Conversion</h1>
  <p>Visual comparison of source OKLCH colors and converted RGB/Hex values.</p>
  <p><strong>Total color tokens:</strong> ${colorTokens.length}</p>
  <table>
    <thead>
      <tr>
        <th>Token</th>
        <th>OKLCH (Source)</th>
        <th>Preview</th>
        <th>Hex (Converted)</th>
        <th>Preview</th>
      </tr>
    </thead>
    <tbody>
      ${rows}
    </tbody>
  </table>
  <footer style="margin-top: 40px; color: #666; font-size: 12px;">
    Generated by Phoenix Token Pipeline
  </footer>
</body>
</html>`
}
```

Both formats follow the Style Dictionary format API: receive { dictionary, options, file }, return string.
</action>
<verify>
Both files exist:

- packages/tokens/src/formats/token-mapping.mjs
- packages/tokens/src/formats/color-comparison.mjs

Both export named functions:

```bash
node -e "import('./packages/tokens/src/formats/token-mapping.mjs').then(m => console.log(typeof m.tokenMappingFormat))"
node -e "import('./packages/tokens/src/formats/color-comparison.mjs').then(m => console.log(typeof m.colorComparisonFormat))"
```

Both should output "function".
</verify>
<done>token-mapping.mjs and color-comparison.mjs export format functions ready for registration.</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Dependency installed:

   ```bash
   cd packages/tokens && pnpm ls @tokens-studio/sd-transforms
   ```

   Should show version 2.x

2. All format files exist and are valid ESM:

   ```bash
   ls packages/tokens/src/formats/
   ```

   Should show: tokens-studio.mjs, token-mapping.mjs, color-comparison.mjs

3. Formats are importable:
   ```bash
   node -e "
     Promise.all([
       import('./packages/tokens/src/formats/tokens-studio.mjs'),
       import('./packages/tokens/src/formats/token-mapping.mjs'),
       import('./packages/tokens/src/formats/color-comparison.mjs')
     ]).then(() => console.log('All formats valid'))
   "
   ```
   </verification>

<success_criteria>

- @tokens-studio/sd-transforms ^2.0.0 installed in packages/tokens
- packages/tokens/src/formats/ directory exists with 3 format files
- All formats export named functions following SD format API
- No import errors when loading format modules
  </success_criteria>

<output>
After completion, create `.planning/phases/07-token-pipeline-integration/07-01-SUMMARY.md`
</output>
