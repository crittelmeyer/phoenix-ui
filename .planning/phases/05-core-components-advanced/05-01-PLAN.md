---
phase: 05-core-components-advanced
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/ui/package.json
  - packages/ui/src/components/dropdown-menu.tsx
  - packages/ui/src/components/dropdown-menu.figma.tsx
  - apps/storybook/stories/DropdownMenu.stories.tsx
autonomous: true

must_haves:
  truths:
    - 'DropdownMenu opens on trigger click with keyboard navigation (arrow keys, Home/End, typeahead)'
    - 'Nested SubMenu opens on hover (desktop) with SubTrigger chevron indicator'
    - 'CheckboxItem and RadioItem toggle state with visual check/dot indicators'
    - 'All dropdown parts use semantic tokens only (bg-background, text-foreground, focus:bg-accent)'
  artifacts:
    - path: 'packages/ui/src/components/dropdown-menu.tsx'
      provides: 'DropdownMenu compound component (14+ parts)'
      exports:
        [
          'DropdownMenu',
          'DropdownMenuTrigger',
          'DropdownMenuContent',
          'DropdownMenuItem',
          'DropdownMenuCheckboxItem',
          'DropdownMenuRadioGroup',
          'DropdownMenuRadioItem',
          'DropdownMenuLabel',
          'DropdownMenuSeparator',
          'DropdownMenuShortcut',
          'DropdownMenuGroup',
          'DropdownMenuPortal',
          'DropdownMenuSub',
          'DropdownMenuSubContent',
          'DropdownMenuSubTrigger',
        ]
    - path: 'packages/ui/src/components/dropdown-menu.figma.tsx'
      provides: 'Figma Code Connect placeholder mapping'
    - path: 'apps/storybook/stories/DropdownMenu.stories.tsx'
      provides: 'Storybook stories with autodocs'
  key_links:
    - from: 'dropdown-menu.tsx'
      to: '@radix-ui/react-dropdown-menu'
      via: 'Radix primitive wrapping'
      pattern: 'DropdownMenuPrimitive'
    - from: 'DropdownMenu.stories.tsx'
      to: '@phoenix/ui'
      via: 'barrel import'
      pattern: "import.*from '@phoenix/ui'"
---

<objective>
Install all Phase 5 dependencies and implement the DropdownMenu compound component with full Radix primitive surface, Storybook story, and Figma Code Connect mapping.

Purpose: DropdownMenu is the most complex Phase 5 component (14+ parts including SubMenu, CheckboxItem, RadioItem). Building it first establishes the pattern and validates dependency installation for the remaining components.

Output: Working DropdownMenu component with all parts exported, interactive Storybook story, and Figma Code Connect placeholder.
</objective>

<execution_context>
@/Users/chris/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-core-components-advanced/05-RESEARCH.md
@.planning/phases/05-core-components-advanced/05-CONTEXT.md

Reference existing patterns:
@packages/ui/src/components/dialog.tsx (compound component template)
@packages/ui/src/components/select.tsx (compound component with inline SVG)
@apps/storybook/stories/Dialog.stories.tsx (story template)
@packages/ui/src/components/button.figma.tsx (figma connect template)
@packages/ui/package.json (add new dependencies here)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Phase 5 dependencies</name>
  <files>packages/ui/package.json</files>
  <action>
  Run from the packages/ui directory:

```bash
cd packages/ui && pnpm add @radix-ui/react-dropdown-menu @radix-ui/react-tabs @radix-ui/react-tooltip sonner react-hook-form zod @hookform/resolvers
```

This installs ALL Phase 5 dependencies at once (not just DropdownMenu) so Plans 02 and 03 don't need to touch package.json.

Verify package.json has all 7 new dependencies added to the dependencies section.
</action>
<verify>

```bash
cd packages/ui && cat package.json | grep -E "(dropdown-menu|tabs|tooltip|sonner|react-hook-form|zod|hookform)"
```

All 7 packages listed in dependencies.
</verify>
<done>packages/ui/package.json contains @radix-ui/react-dropdown-menu, @radix-ui/react-tabs, @radix-ui/react-tooltip, sonner, react-hook-form, zod, @hookform/resolvers as dependencies.</done>
</task>

<task type="auto">
  <name>Task 2: Implement DropdownMenu compound component with story and Figma mapping</name>
  <files>
    packages/ui/src/components/dropdown-menu.tsx
    packages/ui/src/components/dropdown-menu.figma.tsx
    apps/storybook/stories/DropdownMenu.stories.tsx
  </files>
  <action>
  **dropdown-menu.tsx** — Create compound component following the exact Dialog/Select pattern from Phase 3:

1. Import `* as DropdownMenuPrimitive from '@radix-ui/react-dropdown-menu'` and `cn` from `../lib/utils`
2. Direct re-exports (no styling needed): `DropdownMenu` (Root), `DropdownMenuTrigger`, `DropdownMenuGroup`, `DropdownMenuPortal`, `DropdownMenuSub`, `DropdownMenuRadioGroup`
3. Styled parts with `React.forwardRef` + `cn()` + semantic tokens:

**DropdownMenuContent** — Portal-wrapped, styled with:

- `z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md`
- Animation: `data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95`
- Side-aware slide animations using `data-[side=bottom]:slide-in-from-top-2` etc. for all 4 sides
- Default `sideOffset={4}`

**DropdownMenuItem** — Styled with:

- `relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none`
- `focus:bg-accent focus:text-accent-foreground`
- `data-[disabled]:pointer-events-none data-[disabled]:opacity-50`
- Include `inset` variant: when `inset` prop is true, add `pl-8`
- Accept `inset?: boolean` as additional prop

**DropdownMenuCheckboxItem** — Styled similar to MenuItem plus:

- `pl-8` padding for indicator space
- Include check indicator span positioned `absolute left-2` with inline SVG check icon (copy from Checkbox component):
  ```
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4"><path d="M20 6 9 17l-5-5"/></svg>
  ```
- Wrap indicator in `<DropdownMenuPrimitive.ItemIndicator className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">`

**DropdownMenuRadioItem** — Similar to CheckboxItem but with dot indicator:

- Same base styling as CheckboxItem (`pl-8`)
- Indicator uses filled circle SVG:
  ```
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="6"/></svg>
  ```

**DropdownMenuLabel** — Styled with:

- `px-2 py-1.5 text-sm font-semibold`
- Accept `inset?: boolean`, when true add `pl-8`

**DropdownMenuSeparator** — Styled with:

- `-mx-1 my-1 h-px bg-muted`

**DropdownMenuShortcut** — Plain span (not forwardRef):

- `ml-auto text-xs tracking-widest opacity-60`

**DropdownMenuSubTrigger** — Styled with:

- Same focus states as MenuItem
- `data-[state=open]:bg-accent` for when submenu is open
- Include right-pointing chevron SVG:
  ```
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="ml-auto h-4 w-4"><path d="m9 18 6-6-6-6"/></svg>
  ```

**DropdownMenuSubContent** — Same styling as DropdownMenuContent (portal-wrapped, same animations).

4. Set `displayName` on all forwardRef components
5. Export all 15 parts from the file

IMPORTANT: Use semantic tokens ONLY. No hardcoded colors. No arbitrary values. Follow the exact forwardRef + cn() pattern from dialog.tsx.

**DropdownMenu.stories.tsx** — CSF 3.0 format:

- `title: 'Components/DropdownMenu'`
- `component: DropdownMenu` with `subcomponents` listing key parts
- `parameters: { layout: 'centered' }`, `tags: ['autodocs']`
- Import components from `@phoenix/ui` plus `Button`
- **Default story:** Button trigger, content with Label, Separator, 3 basic Items, Separator, SubMenu with 3 items
- **WithCheckboxItems story:** DropdownMenu with 3 CheckboxItems using React.useState for checked state
- **WithRadioItems story:** DropdownMenu with RadioGroup containing 3 RadioItems using React.useState for selected value
- **WithShortcuts story:** DropdownMenu items showing keyboard shortcut hints via DropdownMenuShortcut

**dropdown-menu.figma.tsx** — Follow button.figma.tsx pattern:

- Import figma from '@figma/code-connect'
- Import DropdownMenu components from './dropdown-menu'
- Placeholder URL: 'https://www.figma.com/design/FIGMA_FILE_KEY?node-id=NODE_ID'
- Props: open (boolean)
- Example: Basic DropdownMenu with Trigger, Content, and 3 Items
  </action>
  <verify>

```bash
cd /Users/chris/Repos/phoenix && pnpm turbo run typecheck --filter=@phoenix/ui
```

TypeScript compiles without errors. Then verify Storybook builds:

```bash
cd /Users/chris/Repos/phoenix && pnpm turbo run build --filter=storybook 2>&1 | tail -5
```

  </verify>
  <done>
  - dropdown-menu.tsx exports 15 parts (DropdownMenu through DropdownMenuShortcut)
  - All parts use semantic tokens only (bg-popover, text-popover-foreground, focus:bg-accent, bg-muted)
  - DropdownMenu.stories.tsx has 4 stories (Default, WithCheckboxItems, WithRadioItems, WithShortcuts)
  - dropdown-menu.figma.tsx has placeholder Figma Code Connect mapping
  - TypeScript compiles without errors
  </done>
</task>

</tasks>

<verification>
1. `pnpm turbo run typecheck --filter=@phoenix/ui` passes
2. All 7 Phase 5 dependencies present in packages/ui/package.json
3. dropdown-menu.tsx exports exactly 15 named parts
4. No hardcoded color values (hex, rgb, named colors) in dropdown-menu.tsx — only semantic token classes
5. Story file imports from '@phoenix/ui' (not relative paths)
</verification>

<success_criteria>

- DropdownMenu compound component complete with 15 exported parts
- Full Radix surface: Item, CheckboxItem, RadioItem, SubMenu, Label, Separator, Shortcut
- Interactive Storybook story with 4 variants demonstrating all item types
- Figma Code Connect placeholder file created
- All Phase 5 npm dependencies installed
- Zero TypeScript errors
  </success_criteria>

<output>
After completion, create `.planning/phases/05-core-components-advanced/05-01-SUMMARY.md`
</output>
