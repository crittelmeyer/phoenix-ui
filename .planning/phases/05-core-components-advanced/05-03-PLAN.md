---
phase: 05-core-components-advanced
plan: 03
type: execute
wave: 3
depends_on: ['05-01', '05-02']
files_modified:
  - packages/ui/src/components/form.tsx
  - packages/ui/src/components/form.figma.tsx
  - apps/storybook/stories/Form.stories.tsx
  - packages/ui/src/index.ts
autonomous: true

must_haves:
  truths:
    - 'Form validates on submit first, then switches to live validation as user corrects'
    - 'FormMessage displays error text below field in destructive color'
    - 'FormLabel turns destructive color when its field has an error'
    - 'FormDescription provides muted helper text for field guidance'
    - 'All 12 components export from packages/ui/src/index.ts'
    - 'Every component uses semantic token classes only (no hardcoded colors)'
  artifacts:
    - path: 'packages/ui/src/components/form.tsx'
      provides: 'Form wrapper with react-hook-form context (6 parts)'
      exports:
        [
          'Form',
          'FormField',
          'FormItem',
          'FormLabel',
          'FormControl',
          'FormDescription',
          'FormMessage',
          'useFormField',
        ]
    - path: 'packages/ui/src/components/form.figma.tsx'
      provides: 'Figma Code Connect placeholder mapping'
    - path: 'apps/storybook/stories/Form.stories.tsx'
      provides: 'Form stories with validation examples'
    - path: 'packages/ui/src/index.ts'
      provides: 'Complete barrel export for all 12 components'
      contains: 'dropdown-menu|tabs|tooltip|toast|form'
  key_links:
    - from: 'form.tsx'
      to: 'react-hook-form'
      via: 'FormProvider and Controller'
      pattern: 'useFormContext|Controller'
    - from: 'form.tsx'
      to: '@radix-ui/react-label'
      via: 'Label primitive for FormLabel'
      pattern: 'import.*Label'
    - from: 'form.tsx'
      to: '@radix-ui/react-slot'
      via: 'Slot for FormControl prop merging'
      pattern: 'import.*Slot'
    - from: 'index.ts'
      to: 'all component files'
      via: 're-export'
      pattern: "export.*from './components/"
---

<objective>
Implement the Form wrapper component integrating react-hook-form with Zod validation, update barrel exports for all 12 components, and verify semantic token usage across the entire library.

Purpose: Form is the final and most architecturally distinct Phase 5 component — it integrates external state management (react-hook-form) with the UI library via React Context. The barrel export update completes COMP-14 and the semantic token audit satisfies COMP-15.

Output: Working Form component with full shadcn/ui FormField pattern, updated barrel exports, and verified semantic token compliance.
</objective>

<execution_context>
@/Users/chris/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-core-components-advanced/05-RESEARCH.md
@.planning/phases/05-core-components-advanced/05-CONTEXT.md
@.planning/phases/05-core-components-advanced/05-01-SUMMARY.md
@.planning/phases/05-core-components-advanced/05-02-SUMMARY.md

Reference existing patterns:
@packages/ui/src/index.ts (barrel export to update)
@packages/ui/src/components/label.tsx (Label primitive used by FormLabel)
@packages/ui/src/components/input.tsx (used in Form stories)
@packages/ui/src/components/textarea.tsx (used in Form stories)
@packages/ui/src/components/checkbox.tsx (used in Form stories)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Form wrapper component with story and Figma mapping</name>
  <files>
    packages/ui/src/components/form.tsx
    packages/ui/src/components/form.figma.tsx
    apps/storybook/stories/Form.stories.tsx
  </files>
  <action>
  **form.tsx** — Full shadcn/ui Form pattern with react-hook-form context:

This component is architecturally different from the Radix compound components. It provides React Context to connect react-hook-form's field state to UI components.

1. Imports:

- `React` (useContext, useId, createContext, forwardRef)
- `{ Controller, FormProvider, useFormContext, type ControllerProps, type FieldPath, type FieldValues }` from `'react-hook-form'`
- `{ Slot }` from `'@radix-ui/react-slot'`
- `{ Label }` from `'./label'`
- `{ cn }` from `'../lib/utils'`

2. **Form** — Direct re-export of `FormProvider` from react-hook-form:

```typescript
const Form = FormProvider
```

3. **FormFieldContext** — React Context holding field name:

```typescript
type FormFieldContextValue = { name: string }
const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue,
)
```

4. **FormField** — Wrapper around react-hook-form's Controller:

```typescript
const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
>({ ...props }: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}
```

5. **useFormField** — Custom hook connecting context to form state:

```typescript
const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState, formState } = useFormContext()

  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error('useFormField should be used within <FormField>')
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}
```

6. **FormItemContext** — React Context holding auto-generated ID:

```typescript
type FormItemContextValue = { id: string }
const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue,
)
```

7. **FormItem** — Container div with auto-generated ID via useId:

```typescript
const FormItem = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => {
    const id = React.useId()
    return (
      <FormItemContext.Provider value={{ id }}>
        <div ref={ref} className={cn('space-y-2', className)} {...props} />
      </FormItemContext.Provider>
    )
  },
)
FormItem.displayName = 'FormItem'
```

8. **FormLabel** — Label that turns destructive on error:

```typescript
const FormLabel = React.forwardRef<
  React.ElementRef<typeof Label>,
  React.ComponentPropsWithoutRef<typeof Label>
>(({ className, ...props }, ref) => {
  const { error, formItemId } = useFormField()
  return (
    <Label
      ref={ref}
      className={cn(error && 'text-destructive', className)}
      htmlFor={formItemId}
      {...props}
    />
  )
})
FormLabel.displayName = 'FormLabel'
```

9. **FormControl** — Slot that wires aria attributes:

```typescript
const FormControl = React.forwardRef<
  React.ElementRef<typeof Slot>,
  React.ComponentPropsWithoutRef<typeof Slot>
>(({ ...props }, ref) => {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()
  return (
    <Slot
      ref={ref}
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
})
FormControl.displayName = 'FormControl'
```

10. **FormDescription** — Muted helper text:

```typescript
const FormDescription = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(
  ({ className, ...props }, ref) => {
    const { formDescriptionId } = useFormField()
    return (
      <p
        ref={ref}
        id={formDescriptionId}
        className={cn('text-muted-foreground text-sm', className)}
        {...props}
      />
    )
  },
)
FormDescription.displayName = 'FormDescription'
```

11. **FormMessage** — Error message in destructive color:

```typescript
const FormMessage = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(
  ({ className, children, ...props }, ref) => {
    const { error, formMessageId } = useFormField()
    const body = error ? String(error?.message) : children
    if (!body) return null
    return (
      <p
        ref={ref}
        id={formMessageId}
        className={cn('text-destructive text-sm font-medium', className)}
        {...props}
      />
    )
  },
)
FormMessage.displayName = 'FormMessage'
```

IMPORTANT: The FormMessage must render `{body}` as children of the `<p>` tag. Don't forget to include it between the opening and closing tags.

12. Export: `Form, FormField, FormItem, FormLabel, FormControl, FormDescription, FormMessage, useFormField`

**Form.stories.tsx** — CSF 3.0:

- `title: 'Components/Form'`, `tags: ['autodocs']`
- `parameters: { layout: 'centered' }`
- Import from `'@phoenix/ui'`: Form, FormField, FormItem, FormLabel, FormControl, FormDescription, FormMessage, Input, Textarea, Button, Checkbox
- Import `{ useForm }` from `'react-hook-form'`
- Import `{ z }` from `'zod'`
- Import `{ zodResolver }` from `'@hookform/resolvers/zod'`

**Default story** — Profile form:

- Zod schema: `username` (string, min 3, max 20), `email` (string, email), `bio` (string, max 160, optional)
- `useForm` with `zodResolver`, `defaultValues: { username: '', email: '', bio: '' }`, `mode: 'onSubmit'`
- 3 FormFields: username (Input), email (Input type="email"), bio (Textarea)
- Each FormField uses FormItem > FormLabel > FormControl > FormDescription > FormMessage pattern
- Submit button, `onSubmit` logs to console

**WithValidationErrors story** — Same form but with intentionally bad defaultValues to show error states:

- Render function that pre-submits the form to trigger validation display
- Actually, better approach: just show the form and let users click Submit to see errors

**WithCheckbox story** — Terms acceptance:

- Zod schema: `terms` (boolean, refine to require true)
- Single Checkbox field using FormField pattern
- Shows FormMessage when checkbox not checked on submit

**form.figma.tsx** — Placeholder:

- Connect Form component
- Example: Simple form with 2 FormFields (Input and Textarea) + Submit button
  </action>
  <verify>

```bash
cd /Users/chris/Repos/phoenix && pnpm turbo run typecheck --filter=@phoenix/ui
```

  </verify>
  <done>
  - form.tsx exports Form, FormField, FormItem, FormLabel, FormControl, FormDescription, FormMessage, useFormField
  - FormLabel turns text-destructive on field error
  - FormMessage displays error.message in text-destructive
  - FormControl wires aria-describedby and aria-invalid
  - Form stories demonstrate Zod validation with multiple field types
  - TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Update barrel exports and verify semantic token compliance</name>
  <files>
    packages/ui/src/index.ts
  </files>
  <action>
  **Update packages/ui/src/index.ts** — Add all 5 new components to barrel export:

Add the following export blocks after the existing Dialog exports:

```typescript
export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioGroup,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
} from './components/dropdown-menu'

export { Tabs, TabsList, TabsTrigger, TabsContent } from './components/tabs'

export {
  Tooltip,
  TooltipTrigger,
  TooltipContent,
  TooltipProvider,
} from './components/tooltip'

export { Toaster } from './components/toast'

export {
  Form,
  FormField,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  useFormField,
} from './components/form'
```

**Semantic token audit** — Verify ALL component files (including Phase 3 components) use semantic tokens only:

Run grep to check for hardcoded color values in component files:

```bash
# Should return NO results
grep -rn "bg-\(red\|blue\|green\|gray\|slate\|zinc\|neutral\|stone\|orange\|amber\|yellow\|lime\|emerald\|teal\|cyan\|sky\|indigo\|violet\|purple\|fuchsia\|pink\|rose\)" packages/ui/src/components/
grep -rn "text-\(red\|blue\|green\|gray\|slate\|zinc\|neutral\|stone\)" packages/ui/src/components/
grep -rn 'style=' packages/ui/src/components/
grep -rn '#[0-9a-fA-F]\{3,8\}' packages/ui/src/components/*.tsx
```

All component files should use ONLY semantic tokens: bg-background, bg-popover, bg-primary, bg-accent, bg-muted, bg-destructive, text-foreground, text-popover-foreground, text-muted-foreground, text-destructive, text-accent-foreground, text-primary-foreground, border, border-input, border-border, border-primary, ring-ring, ring-offset-background.
</action>
<verify>

```bash
# Full typecheck
cd /Users/chris/Repos/phoenix && pnpm turbo run typecheck --filter=@phoenix/ui

# Verify all exports resolve
cd /Users/chris/Repos/phoenix && node -e "
  const fs = require('fs');
  const content = fs.readFileSync('packages/ui/src/index.ts', 'utf8');
  const components = ['dropdown-menu', 'tabs', 'tooltip', 'toast', 'form', 'button', 'input', 'textarea', 'select', 'checkbox', 'radio-group', 'label', 'dialog'];
  const missing = components.filter(c => !content.includes(c));
  if (missing.length) { console.error('Missing:', missing); process.exit(1); }
  console.log('All 13 component modules exported (12 components + label)');
"

# Semantic token audit
cd /Users/chris/Repos/phoenix && grep -rn 'style=' packages/ui/src/components/*.tsx | grep -v '.figma.tsx' || echo 'No inline styles found'
```

  </verify>
  <done>
  - index.ts exports all 12 components (Button, Input, Textarea, Select, Checkbox, RadioGroup, Label, Dialog, DropdownMenu, Tabs, Tooltip, Toaster) plus Form parts
  - All component files pass semantic token audit (no hardcoded colors, no inline styles)
  - `import { Button, DropdownMenu, Tabs, Tooltip, Toaster, Form } from '@phoenix/ui'` works
  - TypeScript compiles without errors
  </done>
</task>

</tasks>

<verification>
1. `pnpm turbo run typecheck --filter=@phoenix/ui` passes
2. form.tsx exports 8 named exports (Form, FormField, FormItem, FormLabel, FormControl, FormDescription, FormMessage, useFormField)
3. index.ts references all 13 component modules (button, input, textarea, select, checkbox, radio-group, label, dialog, dropdown-menu, tabs, tooltip, toast, form)
4. No hardcoded color values in any packages/ui/src/components/*.tsx file
5. No inline style attributes in any component file
6. Form story demonstrates Zod validation with error display
7. All story files import from '@phoenix/ui'
</verification>

<success_criteria>

- Form component implements full shadcn/ui FormField pattern with react-hook-form Context
- Form validates on submit first, then live (mode: 'onSubmit')
- FormLabel turns destructive on error, FormMessage displays error.message
- Barrel export includes all 12 components with 60+ named exports
- Semantic token audit passes: zero hardcoded colors across entire component library
- All 7 COMP requirements satisfied (COMP-09 through COMP-15)
  </success_criteria>

<output>
After completion, create `.planning/phases/05-core-components-advanced/05-03-SUMMARY.md`
</output>
